/*
  QUICKSQL

  flw_type_description
  id number /pk
  id_spc_lang number /fk spc_lang(id)
  flw_type_desc varchar(4000)
  
*/

--------------------------------------------------------
--  DDL for Table FLW_TYPE (INC_REQUETE_TYPE)
--------------------------------------------------------
DROP TABLE FLW_TYPE;
DROP TABLE FLW_TYPE_DETAIL;
DROP TABLE FLW_ACTION;
DROP TABLE FLW_TYPE_DETAIL_ACTION;

CREATE TABLE "FLW_TYPE" (
  "ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER NOCYCLE NOKEEP NOSCALE,
  --"TYPE_CODE" VARCHAR2(50 CHAR) , --COLLATE "USING_NLS_COMP",
  "TYPE_DESCRIPTION"    VARCHAR2(500 CHAR),
  "SPC_LANG_ID" NUMBER
  "REF_ID" NUMBER,
  --"TRIGGER_SPEC_IDS" VARCHAR2(4000) , --COLLATE "USING_NLS_COMP",
  "PRIORITY" NUMBER DEFAULT 1,
  "CREATED" DATE,
  "CREATED_BY" VARCHAR2(500) , --COLLATE "USING_NLS_COMP",
  "MODIFIED" DATE,
  "MODIFIED_BY" VARCHAR2(500 CHAR) --COLLATE "USING_NLS_COMP"
);
COMMENT ON COLUMN "FLW_TYPE"."ID" IS 'Primary key';
COMMENT ON COLUMN "FLW_TYPE"."TYPE_DESCRIPTION" IS 'Flow type description';
COMMENT ON COLUMN "FLW_TYPE"."SPC_LANG_ID" IS 'Reference the ID of language in the spc_lang table';

--------------------------------------------------------
--  DDL for Table FLW_TYPE_DETAIL (INC_REQUETE_TYPE_FLOW)
--------------------------------------------------------
CREATE TABLE "FLW_TYPE_DETAIL" (
  "ID" NUMBER,
  --"CODE_REQUETE_FLOW" VARCHAR2(50) , --COLLATE "USING_NLS_COMP",
  "FLW_TYPE_ID" NUMBER,
  "BUTTON_NAME_FR" VARCHAR2(500) , --COLLATE "USING_NLS_COMP",
  "BUTTON_NAME_EN" VARCHAR2(500) , --COLLATE "USING_NLS_COMP",
  "DETAIL_SEQUENCE" NUMBER,
  "NEXT_DETAIL_SEQUENCE" NUMBER,
  "STATUS" VARCHAR2(255) , --COLLATE "USING_NLS_COMP",
  "ROLE_IDS" VARCHAR2(4000) , --COLLATE "USING_NLS_COMP",
  "MANDATORY_SPEC_IDS" VARCHAR2(4000) , --COLLATE "USING_NLS_COMP", DEFAULT NULL
  "READONLY_SPEC_IDS" VARCHAR2(4000) , --COLLATE "USING_NLS_COMP",  DEFAULT NULL
  "NOTE" VARCHAR2(4000) , --COLLATE "USING_NLS_COMP",
  "CREATED" DATE,
  "CREATED_BY" VARCHAR2(255) , --COLLATE "USING_NLS_COMP",
  "MODIFIED" DATE,
  "MODIFIED_BY" VARCHAR2(255) --COLLATE "USING_NLS_COMP"
);
COMMENT ON COLUMN "FLW_TYPE_DETAIL"."READONLY_SPEC_IDS" IS 'Specificities IDS in readonly mode for this sequence';

--------------------------------------------------------
--  DDL for Table FLW_ACTION
--------------------------------------------------------
CREATE TABLE "FLW_ACTION" 
   (	
    "ID" NUMBER, 
    "DESCRIPTION" VARCHAR2(200) , --COLLATE "USING_NLS_COMP", 
    "CODE_PLSQL" VARCHAR2(4000) , --COLLATE "USING_NLS_COMP", 
    "TYPE" VARCHAR2(20), --COLLATE "USING_NLS_COMP" DEFAULT 'NORMAL', 
    "CODE_ACTION" VARCHAR2(20) --COLLATE "USING_NLS_COMP"
   )  -- DEFAULT COLLATION "USING_NLS_COMP";;
--------------------------------------------------------
--  DDL for Table FLW_TYPE_DETAIL_ACTION (INC_REQUETE_TYPE_FLOW_ACTION)
--------------------------------------------------------
CREATE TABLE "FLW_TYPE_DETAIL_ACTION" (
  "ID" NUMBER,
  "FLW_TYPE_DETAIL_ID" NUMBER,
  "FLW_ACTION_ID" NUMBER,
  "ACTION_PARAMETERS" VARCHAR2(4000) , --COLLATE "USING_NLS_COMP",
  "SPEC_ID" NUMBER,
  "ROLE_ID" NUMBER,
  "USER_ID" NUMBER
);
COMMENT ON COLUMN "FLW_TYPE_DETAIL_ACTION"."SPEC_ID" IS 'Specificities IDS that will be null after action';

--------------------------------------------------------
--  DDL for Index FLW_TYPE_ID_PK
--------------------------------------------------------
CREATE UNIQUE INDEX "FLW_TYPE_ID_PK" ON "FLW_TYPE" (
  "ID"
);

--------------------------------------------------------
--  DDL for Index FLW_TYPE_DETAIL_PK
--------------------------------------------------------
CREATE UNIQUE INDEX "FLW_TYPE_DETAIL_PK" ON "FLW_TYPE_DETAIL" (
  "ID"
);

--------------------------------------------------------
--  DDL for Index FLW_TYPE_DETAIL_UK1
--------------------------------------------------------
CREATE UNIQUE INDEX "FLW_TYPE_DETAIL_UK1" ON "FLW_TYPE_DETAIL" (
  "FLW_TYPE_ID"
  --"CODE_REQUETE_FLOW"
);

--------------------------------------------------------
--  DDL for Index FLW_ACTION_PK
--------------------------------------------------------
  CREATE UNIQUE INDEX "FLW_ACTION_PK" ON "FLW_ACTION" ("ID") 
 ;
--------------------------------------------------------
--  Constraints for Table FLW_ACTION
--------------------------------------------------------
  ALTER TABLE "FLW_ACTION" MODIFY ("TYPE" NOT NULL ENABLE);
  ALTER TABLE "FLW_ACTION" MODIFY ("ID" NOT NULL ENABLE);
  ALTER TABLE "FLW_ACTION" MODIFY ("DESCRIPTION" NOT NULL ENABLE);
  ALTER TABLE "FLW_ACTION" MODIFY ("CODE_PLSQL" NOT NULL ENABLE);
  ALTER TABLE "FLW_ACTION" ADD CONSTRAINT "FLW_ACTION_PK" PRIMARY KEY ("ID")
  USING INDEX  ENABLE;
  ALTER TABLE "FLW_ACTION" ADD CONSTRAINT "FLW_ACTION_CHK1" CHECK (type in ('NORMAL','CANCELLATION','AFFECTATION')) ENABLE;
  ALTER TABLE "FLW_ACTION" MODIFY ("CODE_ACTION" NOT NULL ENABLE);

--------------------------------------------------------
--  DDL for Index FLW_TYPE_DETAIL_ACTION_PK
--------------------------------------------------------
CREATE UNIQUE INDEX "FLW_TYPE_DETAIL_ACTION_PK" ON "FLW_TYPE_DETAIL_ACTION" (
  "ID"
);


--------------------------------------------------------
--  DDL for Sequence FLW_TYPE_SEQ
--------------------------------------------------------
CREATE SEQUENCE  "FLW_TYPE_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1621 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL;
CREATE SEQUENCE  "FLW_ACTION_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1621 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL;
CREATE SEQUENCE  "FLW_TYPE_DETAIL_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1621 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL;
CREATE SEQUENCE  "FLW_TYPE_ACTION_DETAIL_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 461 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL;

--------------------------------------------------------
--  DDL for Trigger FLW_TYPE_BIU
--------------------------------------------------------
CREATE OR REPLACE EDITIONABLE TRIGGER "FLW_TYPE_BIU" BEFORE
  INSERT OR
    UPDATE ON FLW_TYPE FOR EACH ROW
  DECLARE
    L_AUDIT_DATE DATE;
BEGIN
  L_AUDIT_DATE := SYSDATE;
  
  IF INSERTING THEN

  --> primary key
    IF :NEW.ID IS NULL THEN
      :NEW.ID := FLW_TYPE_SEQ.NEXTVAL;
    END IF;

    --> audit
    :NEW.CREATED := L_AUDIT_DATE;
    :NEW.CREATED_BY := NVL(SYS_CONTEXT('APEX$SESSION', 'APP_USER'), USER);
  END IF;

  :NEW.MODIFIED := L_AUDIT_DATE;
  :NEW.MODIFIED_BY := NVL(SYS_CONTEXT('APEX$SESSION', 'APP_USER'), USER);
END FLW_TYPE_BIU;
/
ALTER TRIGGER "FLW_TYPE_BIU" ENABLE;

--------------------------------------------------------
--  DDL for Trigger FLW_TYPE_DETAIL_BIU
--------------------------------------------------------
CREATE OR REPLACE EDITIONABLE TRIGGER "FLW_TYPE_DETAIL_BIU" BEFORE
  INSERT OR
    UPDATE ON FLW_TYPE_DETAIL FOR EACH ROW
  BEGIN
    IF INSERTING AND :NEW.CREATED IS NULL THEN
      :NEW.ID := FLW_TYPE_DETAIL_SEQ.NEXTVAL;
      :NEW.CREATED := SYSDATE;
      :NEW.CREATED_BY := NVL(SYS_CONTEXT('APEX$SESSION', 'APP_USER'), USER);
    END IF;
    IF :NEW.MODIFIED IS NULL OR :NEW.MODIFIED = :OLD.MODIFIED THEN
      :NEW.MODIFIED := SYSDATE;
      :NEW.MODIFIED_BY := NVL(SYS_CONTEXT('APEX$SESSION', 'APP_USER'), USER);
    END IF;
  END FLW_TYPE_DETAIL_BIU;;
/
ALTER TRIGGER "FLW_TYPE_DETAIL_BIU" ENABLE;

--------------------------------------------------------
--  DDL for Trigger FLW_TYPE_DETAIL_ACTION
--------------------------------------------------------
CREATE OR REPLACE EDITIONABLE TRIGGER "FLW_TYPE_DETAIL_ACTION" BEFORE
  INSERT OR
    UPDATE ON FLW_TYPE_DETAIL_ACTION FOR EACH ROW
  BEGIN
    IF INSERTING THEN
      :NEW.ID := FLW_TYPE_ACTION_DETAIL_SEQ.NEXTVAL;
    END IF;
  END FLW_TYPE_DETAIL_ACTION_BIU;
/
ALTER TRIGGER "FLW_TYPE_DETAIL_ACTION" ENABLE;

--------------------------------------------------------
--  Constraints for Table FLW_TYPE
--------------------------------------------------------
ALTER TABLE "FLW_TYPE" MODIFY ("ID" NOT NULL ENABLE);
--ALTER TABLE "FLW_TYPE" MODIFY ("TYPE_CODE" NOT NULL ENABLE);
ALTER TABLE "FLW_TYPE" MODIFY ("TYPE_DESCRIPTION_FR" NOT NULL ENABLE);
ALTER TABLE "FLW_TYPE" MODIFY ("TYPE_DESCRIPTION_EN" NOT NULL ENABLE);
ALTER TABLE "FLW_TYPE" MODIFY ("CREATED" NOT NULL ENABLE);
ALTER TABLE "FLW_TYPE" MODIFY ("CREATED_BY" NOT NULL ENABLE);
ALTER TABLE "FLW_TYPE" MODIFY ("MODIFIED" NOT NULL ENABLE);
ALTER TABLE "FLW_TYPE" MODIFY ("MODIFIED_BY" NOT NULL ENABLE);
ALTER TABLE "FLW_TYPE" ADD CONSTRAINT "FLW_TYPE_ID_PK" PRIMARY KEY ("ID") USING INDEX ENABLE;

ALTER TABLE "FLW_TYPE" ADD CONSTRAINT "FLW_TYPE_CHK1" CHECK ((REF_ID IS NOT NULL
AND TRIGGER_SPEC_IDS IS NOT NULL
--OR LISTE_ID_SERVICES IS NOT NULL)
)
OR 1=1) ENABLE;

--ALTER TABLE "FLW_TYPE" MODIFY ("IND_CONTRAT" NOT NULL ENABLE);
ALTER TABLE "FLW_TYPE" MODIFY ("PRIORITY" NOT NULL ENABLE);

--------------------------------------------------------
--  Constraints for Table FLW_TYPE_DETAIL
--------------------------------------------------------
--ALTER TABLE "FLW_TYPE_DETAIL" MODIFY ("CODE_REQUETE_FLOW" NOT NULL ENABLE);
ALTER TABLE "FLW_TYPE_DETAIL" MODIFY ("FLW_TYPE_ID" NOT NULL ENABLE);
ALTER TABLE "FLW_TYPE_DETAIL" MODIFY ("BUTTON_NAME_FR" NOT NULL ENABLE);
ALTER TABLE "FLW_TYPE_DETAIL" MODIFY ("BUTTON_NAME_EN" NOT NULL ENABLE);
ALTER TABLE "FLW_TYPE_DETAIL" MODIFY ("DETAIL_SEQUENCE" NOT NULL ENABLE);
ALTER TABLE "FLW_TYPE_DETAIL" MODIFY ("ID" NOT NULL ENABLE);
ALTER TABLE "FLW_TYPE_DETAIL" ADD CONSTRAINT "FLW_TYPE_DETAIL_UK1" UNIQUE ("FLW_TYPE_ID") USING INDEX ENABLE; --, "CODE_REQUETE_FLOW"
ALTER TABLE "FLW_TYPE_DETAIL" ADD CONSTRAINT "FLW_TYPE_DETAIL_PK" PRIMARY KEY ("ID") USING INDEX ENABLE;

--------------------------------------------------------
--  Constraints for Table FLW_TYPE_DETAIL_ACTION
--------------------------------------------------------
ALTER TABLE "FLW_TYPE_DETAIL_ACTION" MODIFY ("ID" NOT NULL ENABLE);
ALTER TABLE "FLW_TYPE_DETAIL_ACTION" MODIFY ("FLW_TYPE_DETAIL_ID" NOT NULL ENABLE);
ALTER TABLE "FLW_TYPE_DETAIL_ACTION" MODIFY ("FLW_ACTION_ID" NOT NULL ENABLE);
ALTER TABLE "FLW_TYPE_DETAIL_ACTION" ADD CONSTRAINT "FLW_TYPE_DETAIL_ACTION_PK" PRIMARY KEY ("ID") USING INDEX ENABLE;

-- ALTER TABLE "FLW_TYPE_DETAIL_ACTION" MODIFY (--"UNITE_AFF_ID" NOT NULL ENABLE);
--------------------------------------------------------
--  Ref Constraints for Table FLW_TYPE
--------------------------------------------------------

--ALTER TABLE "FLW_TYPE" ADD CONSTRAINT "FLW_TYPE_FK1" FOREIGN KEY ("REF_ID") REFERENCES "INC_CONTRAT_CATEGORIE" ("REF_ID") ENABLE;

--------------------------------------------------------
--  Ref Constraints for Table FLW_TYPE_DETAIL
--------------------------------------------------------
ALTER TABLE "FLW_TYPE_DETAIL" ADD CONSTRAINT "FLW_TYPE_DETAIL_FK1" FOREIGN KEY ("FLW_TYPE_ID") REFERENCES "FLW_TYPE" ("ID") ENABLE;

--------------------------------------------------------
--  Ref Constraints for Table FLW_TYPE_DETAIL_ACTION
--------------------------------------------------------
ALTER TABLE "FLW_TYPE_DETAIL_ACTION" ADD CONSTRAINT "FLW_TYPE_DETAIL_ACTION_FK1" FOREIGN KEY ("FLW_TYPE_DETAIL_ID") REFERENCES "FLW_TYPE_DETAIL" ("ID") ON DELETE CASCADE ENABLE;
ALTER TABLE "FLW_TYPE_DETAIL_ACTION" ADD CONSTRAINT "FLW_TYPE_DETAIL_ACTION_FK2" FOREIGN KEY ("FLW_ACTION_ID") REFERENCES "FLW_ACTION" ("ID") ENABLE;
--ALTER TABLE "FLW_TYPE_DETAIL_ACTION" ADD CONSTRAINT "FLW_TYPE_DETAIL_ACTION_FK3" FOREIGN KEY ("SPEC_ID") REFERENCES "INC_REQUETE_SPECIFICITES" ("ID") ENABLE;
--ALTER TABLE "FLW_TYPE_DETAIL_ACTION" ADD CONSTRAINT "FLW_TYPE_DETAIL_ACTION_FK4" FOREIGN KEY ("ROLE_ID") REFERENCES "INB_ROLE" ("ID") ENABLE;
--ALTER TABLE "FLW_TYPE_DETAIL_ACTION" ADD CONSTRAINT "FLW_TYPE_DETAIL_ACTION_FK5" FOREIGN KEY ("USER_ID") REFERENCES "INB_USER" ("ID") ENABLE;